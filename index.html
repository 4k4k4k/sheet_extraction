<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NoBroker Loans - EMI Savings Calculator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #ff1744 0%, #d50000 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.98);
      max-width: 500px;
      width: 100%;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      overflow: hidden;
    }

    .header {
      background: white;
      padding: 30px;
      text-align: center;
      border-bottom: 1px solid #f0f0f0;
    }

    .header h1 {
      font-size: 26px;
      color: #ff1744;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 14px;
      color: #666;
    }

    .content {
      padding: 30px;
    }

    .step {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .step.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .step h3 {
      color: #333;
      margin-bottom: 20px;
      font-size: 18px;
    }

    .input-group {
      margin-bottom: 25px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
      font-size: 14px;
    }

    .input-group input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #fafafa;
    }

    .input-group input:focus {
      outline: none;
      border-color: #ff1744;
      background: white;
      box-shadow: 0 0 0 3px rgba(255, 23, 68, 0.1);
    }

    .input-group small {
      display: block;
      margin-top: 5px;
      color: #999;
      font-size: 12px;
    }

    .khata-options {
      display: grid;
      gap: 10px;
    }

    .khata-option {
      padding: 12px 15px;
      background: #f8f9fa;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      font-size: 14px;
    }

    .khata-option:hover {
      background: #ffebee;
      border-color: #ff1744;
    }

    .khata-option.selected {
      background: #ff1744;
      color: white;
      border-color: #ff1744;
    }

    .bank-category {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }

    .category-option {
      flex: 1;
      padding: 15px;
      background: #f8f9fa;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s ease;
    }

    .category-option:hover {
      background: #ffebee;
      border-color: #ff1744;
    }

    .category-option.selected {
      background: #ff1744;
      color: white;
      border-color: #ff1744;
    }

    .category-option h4 {
      margin-bottom: 5px;
      font-size: 16px;
    }

    .category-option p {
      font-size: 12px;
      opacity: 0.8;
    }

    .btns {
      display: flex;
      gap: 10px;
      margin-top: 30px;
    }

    .btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: #ff1744;
      color: white;
    }

    .btn-primary:hover {
      background: #d50000;
      transform: translateY(-1px);
      box-shadow: 0 5px 15px rgba(255, 23, 68, 0.3);
    }

    .btn-secondary {
      background: #e0e0e0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #d0d0d0;
    }

    .btn-success {
      background: #4caf50;
      color: white;
    }

    .btn-success:hover {
      background: #45a049;
      transform: translateY(-1px);
      box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
    }

    .progress-bar {
      height: 4px;
      background: #f0f0f0;
      border-radius: 2px;
      margin-bottom: 30px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: #ff1744;
      border-radius: 2px;
      transition: width 0.5s ease;
    }

    .loader {
      display: none;
      text-align: center;
      padding: 40px 20px;
    }

    .loader-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #ff1744;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error-msg {
      background: #ffebee;
      color: #c62828;
      padding: 12px 15px;
      border-radius: 8px;
      margin-top: 15px;
      display: none;
      font-size: 14px;
    }

    .result-section {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .final-result {
      background: #f5f5f5;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 20px;
    }

    .result-card {
      background: white;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .result-card h5 {
      color: #666;
      margin-bottom: 5px;
      font-size: 13px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .result-card .value {
      font-size: 22px;
      font-weight: 700;
      color: #333;
    }

    .result-card.highlight {
      background: #ff1744;
      color: white;
    }

    .result-card.highlight h5 {
      color: rgba(255, 255, 255, 0.9);
    }

    .result-card.highlight .value {
      color: white;
    }

    .result-card.success {
      background: #e8f5e9;
      border: 1px solid #4caf50;
    }

    .result-card.success .value {
      color: #2e7d32;
    }

    .callback-form {
      background: white;
      padding: 25px;
      border-radius: 15px;
      margin-top: 20px;
    }

    .callback-form h4 {
      color: #333;
      margin-bottom: 20px;
      text-align: center;
      font-size: 18px;
    }

    .thank-you {
      text-align: center;
      padding: 40px;
    }

    .thank-you h2 {
      color: #ff1744;
      margin-bottom: 20px;
    }

    .thank-you p {
      color: #666;
      margin-bottom: 15px;
      font-size: 15px;
    }

    .thank-you .icon {
      font-size: 60px;
      margin-bottom: 20px;
    }

    .powered-by {
      text-align: center;
      padding: 15px;
      color: #999;
      font-size: 12px;
      border-top: 1px solid #f0f0f0;
    }

    @media (max-width: 480px) {
      .bank-category {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>NoBroker Loans</h1>
      <p>Reduce Your Home Loan EMI - Get the best rates from 20+ banks</p>
    </div>

    <div class="content">
      <div class="progress-bar">
        <div class="progress-fill" id="progressBar" style="width: 0%"></div>
      </div>

      <!-- Step 1 -->
      <div class="step active" id="step1">
        <h3>What's your credit score?</h3>
        <div class="input-group">
          <label>Enter your CIBIL/Credit score</label>
          <input type="number" id="creditScore" min="300" max="900" placeholder="e.g., 750">
          <small>Credit score should be between 300 and 900</small>
        </div>
        <div class="btns">
          <button class="btn btn-primary" onclick="nextStep(1)">Continue</button>
        </div>
      </div>

      <!-- Step 2 -->
      <div class="step" id="step2">
        <h3>Remaining loan amount</h3>
        <div class="input-group">
          <label>Enter amount in Lakhs (â‚¹)</label>
          <input type="number" id="loanAmount" step="0.1" placeholder="e.g., 45.5">
          <small>Current outstanding principal amount</small>
        </div>
        <div class="btns">
          <button class="btn btn-secondary" onclick="backStep(2)">Back</button>
          <button class="btn btn-primary" onclick="nextStep(2)">Continue</button>
        </div>
      </div>

      <!-- Step 3 -->
      <div class="step" id="step3">
        <h3>Your current interest rate</h3>
        <div class="input-group">
          <label>Enter your current ROI (%)</label>
          <input type="number" id="currentROI" step="0.01" placeholder="e.g., 8.5">
          <small>Check your loan statement for current rate</small>
        </div>
        <div class="btns">
          <button class="btn btn-secondary" onclick="backStep(3)">Back</button>
          <button class="btn btn-primary" onclick="nextStep(3)">Continue</button>
        </div>
      </div>

      <!-- Step 4 -->
      <div class="step" id="step4">
        <h3>Remaining tenure</h3>
        <div class="input-group">
          <label>Enter remaining years</label>
          <input type="number" id="tenure" step="0.1" placeholder="e.g., 15">
          <small>Years left to complete the loan</small>
        </div>
        <div class="btns">
          <button class="btn btn-secondary" onclick="backStep(4)">Back</button>
          <button class="btn btn-primary" onclick="nextStep(4)">Continue</button>
        </div>
      </div>

      <!-- Step 5 -->
      <div class="step" id="step5">
        <h3>Select your property's Khata type</h3>
        <div class="khata-options">
          <div class="khata-option" data-value="A">A KHATA</div>
          <div class="khata-option" data-value="B">E KHATA(11/A)</div>
          <div class="khata-option" data-value="C">B KHATA</div>
          <div class="khata-option" data-value="D">DC</div>
          <div class="khata-option" data-value="E">GP PROPERTY</div>
        </div>
        <div class="btns">
          <button class="btn btn-secondary" onclick="backStep(5)">Back</button>
          <button class="btn btn-primary" onclick="nextStep(5)">Continue</button>
        </div>
      </div>

      <!-- Step 6 -->
      <div class="step" id="step6">
        <h3>Preferred bank category</h3>
        <div class="bank-category">
          <div class="category-option" data-value="G">
            <h4>Nationalised</h4>
            <p>Government banks only</p>
          </div>
          <div class="category-option" data-value="F">
            <h4>All Banks</h4>
            <p>Best rates from all banks</p>
          </div>
        </div>
        <div class="btns">
          <button class="btn btn-secondary" onclick="backStep(6)">Back</button>
          <button class="btn btn-primary" onclick="calculateFinalResult()">Show Results</button>
        </div>
      </div>

      <!-- Loader -->
      <div class="loader" id="loader">
        <div class="loader-spinner"></div>
        <p>Finding the best rates for you...</p>
        <p style="font-size: 13px; color: #999; margin-top: 10px;">Comparing 20+ banks</p>
      </div>

      <!-- Results -->
      <div class="result-section" id="finalResult">
        <div class="final-result">
          <div class="result-card">
            <h5>Your Current EMI</h5>
            <div class="value" id="currentEMI">â‚¹0</div>
          </div>
          <div class="result-card highlight">
            <h5>Best Available EMI</h5>
            <div class="value" id="bestEMI">â‚¹0</div>
          </div>
          <div class="result-card">
            <h5>Recommended Bank</h5>
            <div class="value" id="bestBank">-</div>
          </div>
          <div class="result-card">
            <h5>Best ROI Available</h5>
            <div class="value" id="bestROI">0%</div>
          </div>
          <div class="result-card success">
            <h5>Monthly Savings</h5>
            <div class="value" id="monthlySavings">â‚¹0</div>
          </div>
          <div class="result-card success">
            <h5>Total Savings</h5>
            <div class="value" id="totalSavings">â‚¹0</div>
          </div>
        </div>
        <div class="btns">
          <button class="btn btn-secondary" onclick="startOver()">Calculate Again</button>
          <button class="btn btn-success" onclick="showCallbackForm()">Get Expert Help</button>
        </div>
      </div>

      <!-- Callback Form -->
      <div class="result-section" id="callbackForm">
        <div class="callback-form">
          <h4>Get Expert Assistance</h4>
          <p style="text-align: center; color: #666; margin-bottom: 20px; font-size: 14px;">Our loan expert will help you switch to the best rate</p>
          <div class="input-group">
            <label>Your Name *</label>
            <input type="text" id="userName" placeholder="Enter your full name">
          </div>
          <div class="input-group">
            <label>Email ID *</label>
            <input type="email" id="userEmail" placeholder="Enter your email">
          </div>
          <div class="input-group">
            <label>Phone Number *</label>
            <input type="tel" id="userPhone" placeholder="10-digit mobile number" maxlength="10">
          </div>
          <div class="btns">
            <button class="btn btn-secondary" onclick="backToResults()">Back</button>
            <button class="btn btn-primary" onclick="submitCallback()">Submit</button>
          </div>
          <div class="error-msg" id="formError"></div>
          <div style="background: #e8f5e9; color: #2e7d32; padding: 12px 15px; border-radius: 8px; margin-top: 15px; display: none; font-size: 14px;" id="formSuccess"></div>
        </div>
      </div>

      <!-- Thank You -->
      <div class="result-section" id="thankYou">
        <div class="thank-you">
          <div class="icon">âœ…</div>
          <h2>Thank You!</h2>
          <p>Your request has been submitted successfully.</p>
          <p>Our loan expert will contact you within 24 hours.</p>
          <p style="font-size: 13px; color: #999;">Redirecting in <span id="countdown">5</span> seconds...</p>
        </div>
      </div>

      <div class="error-msg" id="errorMsg"></div>
    </div>
    
    <div class="powered-by">
      Powered by NoBroker Loans
    </div>
  </div>

  <script>
    // Configuration
    const LEADS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzjUqC5e8wHKRVi06Sm8qhk2z94nqNtD7HflVr5x5EuTbLIcSReTFCSHKNgQSpS9Gk/exec';
    
    /* 
    SIMPLIFIED GOOGLE APPS SCRIPT SETUP:
    1. Create a new Google Sheet
    2. Go to Extensions > Apps Script
    3. Paste the script provided
    4. Replace YOUR_NEW_SHEET_ID with your sheet ID
    5. Deploy as Web App (Execute as: Me, Access: Anyone)
    6. Update LEADS_SCRIPT_URL above with your deployment URL
    */
    
    // Embedded bank data
    const bankData = [
      {"BANK":"HDFC","SCORE MIN":800,"SCORE MAX":900,"ROI":7.6,"PROCESSING FEE":10000,"% MODT":0.5,"A":"A KHATA","B":"E KHATA(11/A)","D":"DC","F":"NEUTRAL"},
      {"BANK":"HDFC","SCORE MIN":750,"SCORE MAX":799,"ROI":7.8,"PROCESSING FEE":10000,"% MODT":0.5,"A":"A KHATA","B":"E KHATA(11/A)","D":"DC","F":"NEUTRAL"},
      {"BANK":"HDFC","SCORE MIN":700,"SCORE MAX":749,"ROI":8,"PROCESSING FEE":10000,"% MODT":0.5,"A":"A KHATA","B":"E KHATA(11/A)","D":"DC","F":"NEUTRAL"},
      {"BANK":"ICICI","SCORE MIN":800,"SCORE MAX":900,"ROI":8,"PROCESSING FEE":20900,"% MODT":0.5,"A":"A KHATA","B":"E KHATA(11/A)","D":"DC","E":"GP PROPERTY","F":"NEUTRAL"},
      {"BANK":"ICICI","SCORE MIN":750,"SCORE MAX":799,"ROI":8.1,"PROCESSING FEE":20900,"% MODT":0.5,"A":"A KHATA","B":"E KHATA(11/A)","D":"DC","E":"GP PROPERTY","F":"NEUTRAL"},
      {"BANK":"AXIS","SCORE MIN":750,"SCORE MAX":900,"ROI":7.95,"PROCESSING FEE":20000,"% MODT":0.45,"A":"A KHATA","B":"E KHATA(11/A)","F":"NEUTRAL"},
      {"BANK":"KOTAK","SCORE MIN":800,"SCORE MAX":900,"ROI":8.05,"PROCESSING FEE":10000,"% MODT":0.5,"A":"A KHATA","B":"E KHATA(11/A)","F":"NEUTRAL"},
      {"BANK":"SBI","SCORE MIN":825,"SCORE MAX":900,"ROI":7.5,"PROCESSING FEE":42300,"% MODT":0.6,"A":"A KHATA","B":"E KHATA(11/A)","F":"NEUTRAL","G":"NATIONALISED"},
      {"BANK":"SBI","SCORE MIN":750,"SCORE MAX":824,"ROI":7.7,"PROCESSING FEE":42300,"% MODT":0.6,"A":"A KHATA","B":"E KHATA(11/A)","F":"NEUTRAL","G":"NATIONALISED"},
      {"BANK":"BOB","SCORE MIN":825,"SCORE MAX":900,"ROI":7.5,"PROCESSING FEE":34000,"% MODT":0.6,"A":"A KHATA","B":"E KHATA(11/A)","F":"NEUTRAL","G":"NATIONALISED"},
      {"BANK":"CANARA","SCORE MIN":800,"SCORE MAX":900,"ROI":7.8,"PROCESSING FEE":2950,"% MODT":0.5,"A":"A KHATA","B":"E KHATA(11/A)","F":"NEUTRAL","G":"NATIONALISED"},
      {"BANK":"PNB","SCORE MIN":800,"SCORE MAX":900,"ROI":7.95,"PROCESSING FEE":10000,"% MODT":0.5,"A":"A KHATA","B":"E KHATA(11/A)","F":"NEUTRAL","G":"NATIONALISED"},
      {"BANK":"BAJAJ","SCORE MIN":825,"SCORE MAX":900,"ROI":7.75,"PROCESSING FEE":0,"% MODT":0.99,"A":"A KHATA","B":"E KHATA(11/A)","C":"B KHATA","D":"DC","E":"GP PROPERTY","F":"NEUTRAL"},
      {"BANK":"PNB HOUSING","SCORE MIN":750,"SCORE MAX":900,"ROI":8.15,"PROCESSING FEE":10000,"% MODT":0.5,"A":"A KHATA","B":"E KHATA(11/A)","C":"B KHATA","D":"DC","E":"GP PROPERTY","F":"NEUTRAL"}
    ];

    let selectedCreditScore = null;
    let selectedKhata = null;
    let selectedCategory = null;

    // Initialize
    window.onload = function() {
      setupEventListeners();
    };

    function setupEventListeners() {
      // Khata selection
      document.querySelectorAll('.khata-option').forEach(option => {
        option.addEventListener('click', function() {
          document.querySelectorAll('.khata-option').forEach(o => o.classList.remove('selected'));
          this.classList.add('selected');
          selectedKhata = this.dataset.value;
        });
      });

      // Bank category selection
      document.querySelectorAll('.category-option').forEach(option => {
        option.addEventListener('click', function() {
          document.querySelectorAll('.category-option').forEach(o => o.classList.remove('selected'));
          this.classList.add('selected');
          selectedCategory = this.dataset.value;
        });
      });

      // Phone number validation
      document.getElementById('userPhone').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);
      });
    }

    function updateProgress(step) {
      const totalSteps = 6;
      const progress = (step / totalSteps) * 100;
      document.getElementById('progressBar').style.width = progress + '%';
    }

    function nextStep(current) {
      if (current === 1) {
        const creditScore = document.getElementById('creditScore').value;
        if (!creditScore || creditScore < 300 || creditScore > 900) {
          showError('Please enter a valid credit score between 300 and 900');
          return;
        }
        selectedCreditScore = parseInt(creditScore);
      }
      if (current === 2) {
        const loanAmount = document.getElementById('loanAmount').value;
        if (!loanAmount || loanAmount <= 0) {
          showError('Please enter a valid loan amount');
          return;
        }
      }
      if (current === 3) {
        const roi = document.getElementById('currentROI').value;
        if (!roi || roi <= 0 || roi > 20) {
          showError('Please enter a valid interest rate');
          return;
        }
      }
      if (current === 4) {
        const tenure = document.getElementById('tenure').value;
        if (!tenure || tenure <= 0 || tenure > 30) {
          showError('Please enter a valid tenure');
          return;
        }
      }
      if (current === 5 && !selectedKhata) {
        showError('Please select your Khata type');
        return;
      }

      hideError();
      document.getElementById(`step${current}`).classList.remove('active');
      document.getElementById(`step${current + 1}`).classList.add('active');
      updateProgress(current + 1);
    }

    function backStep(current) {
      document.getElementById(`step${current}`).classList.remove('active');
      document.getElementById(`step${current - 1}`).classList.add('active');
      updateProgress(current - 1);
    }

    function calculateEMI(principal, rate, months) {
      const monthlyRate = rate / 100 / 12;
      if (monthlyRate === 0) return principal / months;
      return (principal * monthlyRate * Math.pow(1 + monthlyRate, months)) / 
             (Math.pow(1 + monthlyRate, months) - 1);
    }

    function calculateFinalResult() {
      if (!selectedCategory) {
        showError('Please select bank category');
        return;
      }

      hideError();
      document.getElementById('step6').classList.remove('active');
      document.getElementById('loader').style.display = 'block';

      setTimeout(() => {
        const loanAmount = parseFloat(document.getElementById('loanAmount').value) * 100000;
        const currentROI = parseFloat(document.getElementById('currentROI').value);
        const tenure = parseFloat(document.getElementById('tenure').value) * 12;
        const creditScore = selectedCreditScore;

        // Calculate current EMI
        const currentEMI = calculateEMI(loanAmount, currentROI, tenure);

        // Find eligible banks
        const eligibleBanks = bankData.filter(row => {
          const minScore = row['SCORE MIN'];
          const maxScore = row['SCORE MAX'];
          
          if (creditScore < minScore || creditScore > maxScore) return false;
          if (!row[selectedKhata] || row[selectedKhata] === '') return false;
          
          if (selectedCategory === 'G') {
            if (!row['G'] || row['G'] === '') return false;
          } else {
            if (!row['F'] || row['F'] === '') return false;
          }
          
          return true;
        });

        if (eligibleBanks.length === 0) {
          showError('No banks found matching your criteria. Try selecting "All Banks" for more options.');
          document.getElementById('loader').style.display = 'none';
          document.getElementById('step6').classList.add('active');
          return;
        }

        // Sort by ROI
        eligibleBanks.sort((a, b) => a.ROI - b.ROI);
        
        const bestBank = eligibleBanks[0];
        const lowestEMI = calculateEMI(loanAmount, bestBank.ROI, tenure);

        // Display results
        if (currentROI <= bestBank.ROI) {
          document.getElementById('currentEMI').textContent = 
            `â‚¹${currentEMI.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
          document.getElementById('bestEMI').textContent = 
            `â‚¹${currentEMI.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
          document.getElementById('bestBank').textContent = 'Your current rate is the best!';
          document.getElementById('bestROI').textContent = `${currentROI}%`;
          document.getElementById('totalSavings').textContent = 'â‚¹0';
          document.getElementById('monthlySavings').textContent = 'â‚¹0';
        } else {
          const totalSavings = (currentEMI - lowestEMI) * tenure;
          const monthlySavings = currentEMI - lowestEMI;
          
          document.getElementById('currentEMI').textContent = 
            `â‚¹${currentEMI.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
          document.getElementById('bestEMI').textContent = 
            `â‚¹${lowestEMI.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
          document.getElementById('bestBank').textContent = bestBank.BANK;
          document.getElementById('bestROI').textContent = `${bestBank.ROI}%`;
          document.getElementById('totalSavings').textContent = 
            `â‚¹${totalSavings.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
          document.getElementById('monthlySavings').textContent = 
            `â‚¹${monthlySavings.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
        }

        document.getElementById('loader').style.display = 'none';
        document.getElementById('finalResult').style.display = 'block';
      }, 2000);
    }

    function showCallbackForm() {
      document.getElementById('finalResult').style.display = 'none';
      document.getElementById('callbackForm').style.display = 'block';
    }

    function backToResults() {
      document.getElementById('callbackForm').style.display = 'none';
      document.getElementById('finalResult').style.display = 'block';
    }

    function submitCallback() {
      const name = document.getElementById('userName').value.trim();
      const email = document.getElementById('userEmail').value.trim();
      const phone = document.getElementById('userPhone').value.trim();

      if (!name) {
        showFormError('Please enter your name');
        return;
      }
      if (!email || !email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
        showFormError('Please enter a valid email address');
        return;
      }
      if (!phone || phone.length !== 10) {
        showFormError('Please enter a valid 10-digit phone number');
        return;
      }

      hideFormError();
      
      // Show loading
      document.getElementById('loader').style.display = 'block';
      document.getElementById('callbackForm').style.display = 'none';

      // Prepare simplified data for Google Sheets
      const formData = {
        name: name,
        email: email,
        phone: phone,
        creditScore: selectedCreditScore || '',
        loanAmount: document.getElementById('loanAmount').value || '',
        currentROI: document.getElementById('currentROI').value || ''
      };

      console.log('Submitting lead data:', formData);

      // Submit to Google Apps Script
      fetch(LEADS_SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
      })
      .then(() => {
        console.log('Lead submitted successfully');
        showThankYou();
      })
      .catch(error => {
        console.error('Error submitting lead:', error);
        // Show thank you anyway
        showThankYou();
      });
    }

    function showThankYou() {
      document.getElementById('loader').style.display = 'none';
      document.getElementById('thankYou').style.display = 'block';
      
      let countdown = 5;
      const countdownElement = document.getElementById('countdown');
      
      const countdownInterval = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(countdownInterval);
          window.location.href = 'https://www.nobroker.in/';
        }
      }, 1000);
    }

    function startOver() {
      selectedCreditScore = null;
      selectedKhata = null;
      selectedCategory = null;
      
      document.getElementById('creditScore').value = '';
      document.getElementById('loanAmount').value = '';
      document.getElementById('currentROI').value = '';
      document.getElementById('tenure').value = '';
      document.getElementById('userName').value = '';
      document.getElementById('userEmail').value = '';
      document.getElementById('userPhone').value = '';
      
      document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
      document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
      document.getElementById('finalResult').style.display = 'none';
      document.getElementById('callbackForm').style.display = 'none';
      document.getElementById('thankYou').style.display = 'none';
      
      document.getElementById('step1').classList.add('active');
      updateProgress(1);
    }

    function showError(message) {
      const errorMsg = document.getElementById('errorMsg');
      errorMsg.textContent = message;
      errorMsg.style.display = 'block';
      setTimeout(() => {
        errorMsg.style.display = 'none';
      }, 5000);
    }

    function hideError() {
      document.getElementById('errorMsg').style.display = 'none';
    }

    function showFormError(message) {
      const errorMsg = document.getElementById('formError');
      errorMsg.textContent = message;
      errorMsg.style.display = 'block';
    }

    function hideFormError() {
      document.getElementById('formError').style.display = 'none';
    }

    // Add test function for debugging
    function testLeadSubmission() {
      const testData = {
        name: 'Test User',
        email: 'test@example.com',
        phone: '9876543210',
        creditScore: '750',
        loanAmount: '50',
        currentROI: '8.5'
      };
      
      console.log('Testing lead submission with:', testData);
      
      fetch(LEADS_SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(testData)
      })
      .then(() => {
        console.log('Test submission completed');
        alert('Test submission sent. Check your Google Sheet!');
      })
      .catch(error => {
        console.error('Test submission error:', error);
      });
    }
  </script>
</body>
</html>
